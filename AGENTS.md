# Repository Guidelines

## Project Structure & Module Organization
`main.go` wires CLI bootstrapping through Cobra commands defined in `cmd/`. Shared logic sits under `internal/`, grouped by domain (for example `internal/config` for persistence, `internal/tui` for Bubble Tea UI, `internal/portable` for portable-mode helpers). Cross-platform assets and release notes live in `docs/`, while scenario fixtures reside in `test/` and `test-config/`. Backup blobs generated by `ccs` are kept in `ccs.backup/`; leave the folder intact when testing recovery flows.

## Build, Test, and Development Commands
- `go build -o ccs` — produce a local binary; append `.exe` on Windows.
- `go test ./internal/... -v` — run unit tests across all packages.
- `./test.sh [--coverage]` or `test.bat` — orchestrate verbose runs plus optional HTML coverage via `coverage.html`.
- `go run .` — launch the CLI directly when iterating on commands.

## Coding Style & Naming Conventions
Follow standard Go conventions: tabs for indentation, exported identifiers needing doc comments, and uppercase acronyms (`API`, `CLI`) when they remain readable. Keep command files in `cmd/` verb-noun named (`codex_add.go`) to mirror the subcommand invoked. Always run `go fmt ./...` before committing; pair it with `goimports` if your editor does not apply import grouping automatically. New modules belong in `internal/<domain>` with package names that stay lowercase and single word.

## Testing Guidelines
Unit tests target the `internal` packages; place fixtures under `test-config/` to avoid leaking real credentials. Use the `_test.go` suffix and descriptive names such as `TestPortableModeToggle`. Prefer table-driven tests for configuration permutations and include failure assertions for lockfile edge cases. Generate a coverage snapshot with `./test.sh --coverage` when touching stateful flows, and update `docs/testing.md` if scenarios change materially.

## Commit & Pull Request Guidelines
The history follows conventional commits (`feat:`, `fix:`, `docs:`). Keep messages in English or simplified Chinese, but ensure the summary is imperative and under 72 characters. Every pull request should list the primary command or package affected, link to related issues, and mention manual verification steps (`go run . portable on`, screenshots of TUI updates, etc.). Request at least one review for behaviour-affecting work and attach coverage output if risk is high.

## Security & Configuration Tips
Never commit personal Claude tokens; rely on local config files under `~/.config/ccs/` or the portable storage directory. The backup logic trusts filesystem permissions, so confirm restrictive modes on `ccs.backup/` before sharing logs. When writing docs or tests, mask tokens using the existing redaction helpers in `internal/utils/secret.go`.

- Encoding: All code and documentation files must use **UTF-8 without BOM** encoding
- After making code changes but before compiling, always run the following commands:
  - `go fmt ./...` to format the entire project
  - `go test ./...` to run all unit tests
  - `go build -o ccs` for compilation testing
