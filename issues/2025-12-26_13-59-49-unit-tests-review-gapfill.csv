"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"UTRG-010","P0","1","backend","统一测试入口脚本与可复现环境","新增统一测试入口（优先 test.sh，必要时补 test.bat）并将 GOPATH/GOCACHE/GOMODCACHE 固定到工作区 .cache/，避免受限环境写入 HOME 相关 cache。","在干净环境下运行 ./test.sh 能成功执行 go test ./... 并生成 coverage.out（covermode=count）；脚本显式设置 GOPATH/GOCACHE/GOMODCACHE 到工作区 .cache/；README/或 docs/testing.md 明确使用方式与环境变量。","AUTOSERVER","确认脚本不改变现有 CLI 行为；避免依赖真实 HOME/网络；跨平台路径与权限（Windows/WSL/macOS）兼容。","在 Linux/macOS/Windows 各跑一次 ./test.sh（或等价入口）并通过；检查 coverage.out 可被 go tool cover -func 正常解析。","已完成","已完成","已完成","已提交","","plan/2025-12-26_13-47-31-unit-tests-review-gapfill.md:17; docs/testing.md:1; .claude/specs/unit-tests/dev-plan.md:1; test.sh:1; test.bat:1; docs/testing.md:10","picked_reason:P0 提供统一可复现测试入口与缓存目录隔离，优先解阻塞后续覆盖率/评审工作;evidence:./test.sh 执行 go test -coverprofile=coverage.out -covermode=count ./... 成功，且 go tool cover -func=coverage.out 可解析 total;validation_limited:当前环境为 Linux，无法在本机执行 Windows(test.bat)/macOS 回归;manual_test:Windows 运行 `test.bat`；macOS/Linux/WSL 运行 `./test.sh`；随后执行 `go tool cover -func=coverage.out`;risk:low 脚本仅设置本进程 Go 缓存路径并运行测试，不影响 CLI 运行时行为;done_at:2025-12-26"
"UTRG-020","P0","2","backend","按 fix-plan 回放代码评审并修复缺口","对照 fix-plan 的 P0/P1/P2 抽查关键变更，聚焦注入点、测试副作用与断言质量，并把发现的问题补齐到代码/测试中。","完成一次可审计的评审记录（建议落到 docs/ 或 PR 描述），覆盖 cmd/version_test.go 注入、internal/testutil stdout/stderr+cWD 副作用、TUI sweep 断言质量、跨平台权限 skip 策略；相关问题有对应修复与回归测试。","AUTOSERVER","评审点必须对应具体文件与可复现实验；确认修复是根因修复且不引入全局副作用（环境变量、工作目录、stdout/stderr）。","跑 go test ./... 并至少覆盖被评审/修改的包；在 Windows 上验证 skip/权限类测试不误报。","已完成","已完成","已完成","已提交","","plan/2025-12-26_13-47-31-unit-tests-review-gapfill.md:18; .claude/specs/unit-tests/fix-plan.md:1; cmd/version_test.go:1; internal/testutil:1; internal/tui:1; docs/reviews/2025-12-26_unit-tests-fix-plan-review.md:1","picked_reason:P0 先完成可审计的评审回放，确保后续覆盖率/门禁调整建立在稳定测试与无全局副作用的基础上;evidence:已落盘评审记录 docs/reviews/2025-12-26_unit-tests-fix-plan-review.md，并通过 ./test.sh 复跑 go test -coverprofile=coverage.out -covermode=count ./...;validation_limited:当前环境为 Linux，未在 Windows 上实际执行权限 skip 相关回归;manual_test:Windows 执行 `test.bat` 或 `go test ./...`，重点关注权限/skip 用例是否误报;risk:low 本次新增评审记录文档，不改动运行时代码路径;done_at:2025-12-26"
"UTRG-030","P1","3","backend","建立“补充功能缺口表”并绑定验收命令","以 2025-12-23 的 10 条补充项为基准，输出缺口表（已完成/部分完成/缺失），每条提供文件定位与验收命令，作为会议/协作基线。","仓库内落盘一份缺口表（Markdown/CSV 皆可，但需可审计），包含 10 条条目、每条状态、对应 file:line refs、以及可直接复制运行的验收命令。","AUTOSERVER","缺口表必须聚焦“边界合同”（做什么/怎么验收），避免写实现细节；refs 必须能跳转到真实文件。","随机抽查至少 3 条缺口项：refs 指向文件存在、命令可运行、结果与状态一致。","未开始","未开始","未开始","未提交","","plan/2025-12-26_13-47-31-unit-tests-review-gapfill.md:19; plan/2025-12-23_17-34-59-unit-tests-90-coverage.md:1",""
"UTRG-040","P0","4","backend","建立覆盖率基线与 90.5% 目标口径","在统一入口下生成 coverage.out，并明确 total 与关键包覆盖率的口径与目标（total ≥ 90.5%）。","通过统一入口生成 coverage.out（-covermode=count），并能用 go tool cover -func 产出 total 与各包覆盖率；目标口径写入 docs/testing.md（或等价文档）且明确 total ≥ 90.5% 与关键包范围。","AUTOSERVER","确保覆盖率统计口径一致（covermode/count、profile 路径、是否排除生成代码等）；避免把瞬时数值写死导致文档漂移。","在 CI 与本地复跑一次覆盖率生成流程，确认 total 计算一致且输出可被后续门禁读取。","已完成","已完成","已完成","已提交","","plan/2025-12-26_13-47-31-unit-tests-review-gapfill.md:20; docs/testing.md:1; docs/testing.md:279","picked_reason:P0 先定义覆盖率口径与目标（total ≥ 90.5%），为后续补齐覆盖率与 CI 门禁提升提供统一标准;evidence:docs/testing.md 已补齐 covermode=count 口径与 total ≥ 90.5% 目标；本地通过 ./test.sh 生成 coverage.out 并用 go tool cover -func=coverage.out 读取 total;validation_limited:未在 CI 环境复跑 coverage 生成流程（本机仅 Linux）;manual_test:CI 或本地执行 `./test.sh`；随后 `go tool cover -func=coverage.out | grep total` 确认 total 计算一致;risk:low 仅补充文档口径说明，不改变测试/CI 行为;done_at:2025-12-26"
"UTRG-050","P0","5","backend","覆盖率补齐优先级 A（cmd/utils/testutil）","为 cmd、internal/utils、internal/testutil 补齐错误分支/边界路径测试，必要时做最小可测切面（注入/可替换函数），保持 CLI 行为向后兼容。","新增/补充测试覆盖 cmd、internal/utils、internal/testutil 的错误分支/边界路径，且默认行为保持不变；`./test.sh` 与 `go test ./...` 在受限环境下稳定通过；本阶段以 Go 测试输出为准：cmd 覆盖率 ≥ 85%，internal/utils ≥ 84%，internal/testutil ≥ 84%；整体 total ≥ 90.5% 的达成与门禁提升将在后续 UTRG-060/UTRG-070 一并回归验证。","AUTOSERVER","改动面最小化；注入默认值保持原行为；错误分支测试必须有明确断言（非仅执行）。","回归跑 ./test.sh 与 go test ./...；针对新增注入点做一次‘默认路径’与‘错误路径’双场景验证；覆盖率 total ≥ 90.5% 作为全局门禁目标，待 UTRG-060/UTRG-070 完成后统一复测。","已完成","已完成","已完成","已提交","","plan/2025-12-26_13-47-31-unit-tests-review-gapfill.md:21; cmd:1; internal/utils:1; internal/testutil:1; cmd/password.go:1; cmd/open_config.go:1; cmd/add.go:99; internal/utils/file.go:18; internal/testutil/testutil.go:120","picked_reason:P0 提升 cmd/internal/utils/internal/testutil 覆盖率可显著拉升 total，且为后续门禁提升到 90+ 做准备;scope_adjusted:将 total≥90.5 作为跨 issue 的最终门禁目标，本行聚焦 cmd/utils/testutil 覆盖率补齐与稳定性（原因：仅提升这三包不足以在当前口径下稳定拉升 total 到 90.5）;evidence:./test.sh 通过（Go 测试输出：cmd≈85.8%, internal/utils≈84.4%, internal/testutil≈84.3%）；并完成默认/错误路径注入测试（update_self/readPassword/open_config 等）;validation_limited:当前环境为 Linux，未在 Windows/macOS 上执行权限/TTY 相关回归;manual_test:Windows/macOS 运行 `./test.sh`（或 Windows `test.bat`）并关注交互输入/权限相关用例是否稳定;risk:medium 新增少量注入点与 stdin 读取细节调整（bufio reader size），但默认行为不变且已有单测覆盖;done_at:2025-12-26"
"UTRG-060","P1","6","backend","覆盖率补齐优先级 B（claude/portable/version）","为 internal/claude、internal/portable、internal/version 增补测试，统一使用 t.TempDir/t.Setenv 与 stub HTTP client，避免真实 HOME/可执行文件写入/真实网络依赖。","新增测试后满足：internal/version 覆盖率 ≥ 95%；internal/claude 覆盖率 ≥ 98%；internal/portable 覆盖率 = 100%；隔离 HOME（HOME 指向临时目录）运行 ./test.sh 生成 coverage.out，且 go tool cover -func=coverage.out total ≥ 90.0（总目标 total ≥ 90.5 由 UTRG-070/UTRG-080 完成）。","AUTOSERVER","确认所有测试 I/O 都在 t.TempDir 内；HTTP/文件系统依赖可控且可注入；跨平台路径处理正确。","用隔离 HOME（例如 HOME=$(mktemp -d)）运行测试入口；检查不会写入 ~/.codex 或 ~/.claude。","已完成","已完成","已完成","已提交","","plan/2025-12-26_13-47-31-unit-tests-review-gapfill.md:22; internal/claude/plugin.go:21; internal/claude/plugin_test.go:534; internal/portable/portable.go:8; internal/portable/portable_test.go:79; internal/version/version_test.go:285; internal/version/version_test.go:672","picked_reason:P1 优先补齐 internal/claude/portable/version 覆盖率以推动 total 向 90.5% 目标收敛，并为后续 CI 门禁提升解阻塞;evidence:HOME=$(mktemp -d) USERPROFILE=$HOME ./test.sh -> total=90.2, internal/claude=98.7, internal/portable=100.0, internal/version=95.9;done_at:2025-12-26"
"UTRG-070","P2","7","backend","覆盖率补齐优先级 C（TUI 小幅拉升）","为 internal/tui 增补少量状态断言用例，优先修正 sweep 类测试“只跑不验”的路径，在不大规模重构的前提下稳定跨过 90%。","internal/tui 的测试包含明确状态/输出断言（非仅执行）；覆盖率报告中 internal/tui ≥ 90%，且不引入 flaky（多平台稳定）。","AUTOSERVER","避免引入大规模重构；测试断言应稳定且不依赖时序/随机性；TUI 相关全局状态要可复位。","在不同终端/CI 环境重复运行 go test ./internal/tui -count=20 无随机失败（如适用）；全量 go test ./... 通过。","已完成","已完成","已完成","已提交","","plan/2025-12-26_13-47-31-unit-tests-review-gapfill.md:23; internal/tui/tui.go:169; internal/tui/portable.go:9; internal/tui/tui_test.go:145; internal/tui/tui_test.go:923","picked_reason:P2 先补 internal/tui 的关键低覆盖分支并加入稳定断言，以把 total 推过 90.5，为后续 UTRG-080 提升 CI 覆盖率门禁阈值解阻塞;evidence:HOME=$(mktemp -d) USERPROFILE=$HOME ./test.sh -> total=90.5, internal/tui=90.0; go test ./internal/tui -count=20 通过;done_at:2025-12-26"
"UTRG-080","P0","8","backend","门禁对齐：CI 覆盖率阈值提升到 90+","将 CI 中 COVERAGE_THRESHOLD 从 89 提升到 90（或采用 90.5 取整策略），并验证三平台测试稳定。",".github/workflows/test.yml 中覆盖率阈值配置提升到 90（策略明确且在文档说明）；CI 在 Linux/macOS/Windows 运行 go test ./... 并通过，覆盖率门禁不误报。","AUTOSERVER","阈值策略必须与本地统计口径一致；避免“取整/格式化”差异导致门禁抖动；失败时输出可诊断的覆盖率摘要。","至少模拟一次低于阈值的失败场景（例如临时降低阈值/或用 sample）以确认报错信息清晰；回归确认 release workflow 不受影响。","已完成","已完成","已完成","已提交","","plan/2025-12-26_13-47-31-unit-tests-review-gapfill.md:24; .github/workflows/test.yml:11; .github/workflows/test.yml:105","picked_reason:P0 当前 total=90.5 已达成，先提升 CI COVERAGE_THRESHOLD 到 90 以对齐门禁并尽早暴露回归;evidence:local total=90.5; COVERAGE_THRESHOLD=90; awk 比较逻辑模拟：min=90 通过 / min=99 失败;manual_test:触发/观察 GitHub Actions（Test + Coverage Gate）通过，或在 Ubuntu 运行 `go test ./... -coverprofile=coverage.out -covermode=count` 并检查 total ≥ 90;done_at:2025-12-26"
"UTRG-090","P1","9","backend","文档同步：测试入口与覆盖率门禁说明","更新 docs/testing.md，补齐统一测试入口、覆盖率门禁与受限环境 cache 配置说明，避免与真实数据漂移。","docs/testing.md 更新包含：统一入口（test.sh/可选 test.bat）用法、覆盖率生成与门禁说明、GOPATH/GOCACHE/GOMODCACHE 指向工作区 .cache/ 的原因与示例；文档中命令可直接复制运行。","AUTOSERVER","文档不写死易漂移的数据（如瞬时覆盖率数值），必要时标注日期/来源；命令在 Windows/Unix 下各给出等价方式。","按文档命令从零执行一次测试/覆盖率流程；确认与 CI 实际行为一致。","未开始","未开始","未开始","未提交","","plan/2025-12-26_13-47-31-unit-tests-review-gapfill.md:25; docs/testing.md:1",""
